var Splice=function(){function a(a){var b=a.el,c=a.imgs,d=a.dis,e=void 0===d?{left:3,right:3}:d,f=a.range,g=void 0===f?{top:5,right:5,bottom:5,left:100}:f,h=a.scale,i=void 0===h?2:h,j=a.condition,k=a.success,l=a.fail;this.container=document.querySelector(b),this.splice=this.createDiv(this.container,"bc-splice"),this.screen=this.createDiv(this.splice,"bc-splice__screen"),this.strip=this.createDiv(this.splice,"bc-splice__strip"),this.stripH=this.strip.offsetHeight,this.img=this.createDiv(this.screen,"bc-splice__img"),this.rip=this.createCanvas(this.img,"bc-splice__canvas--rip",i),this.ripArea=this.rip.getContext("2d"),this.piece=this.createCanvas(this.img,"bc-splice__canvas--piece",i),this.pieceArea=this.piece.getContext("2d"),this.readyPrompt=this.createDiv(this.splice,"bc-splice__prompt--ready"),this.startPrompt=this.createDiv(this.splice,"bc-splice__prompt--start"),this.slidePrompt=this.createDiv(this.splice,"bc-splice__prompt--slide"),this.loadPrompt=this.createDiv(this.splice,"bc-splice__prompt--check"),this.successPrompt=this.createDiv(this.splice,"bc-splice__prompt--success"),this.failPrompt=this.createDiv(this.splice,"bc-splice__prompt--fail"),this.updateBtn=this.createDiv(this.img,"bc-splice__button--update"),this.closeBtn=this.createDiv(this.img,"bc-splice__button--close"),this.slideBtn=this.createDiv(this.strip,"bc-splice__button--slide"),this.imgs=c,this.imgObjs=null,this.dis=e,this.range={top:g.top*i,right:g.right*i,bottom:g.bottom*i,left:g.left*i},this.scale=i,this.size=this.piece.width,this.randomImgInfo={obj:null,index:null,x:null,y:null,width:null,height:null},this.randomRipInfo={x:null,y:null},this.condition=j,this.success=k,this.fail=l,this.checking=!1,this.init()}var b=a.prototype;return b.init=function(){var c,a=this,b=null;b=/phone|pad|pod|iphone|ipod|ios|ipad|android|mobile/.test(window.navigator.userAgent.toLowerCase())?this.createSlideXTouchEvent:this.createSlideXMouseEvent,this.readyPrompt.style.lineHeight=this.stripH+"px",this.startPrompt.style.lineHeight=this.stripH+"px",this.slidePrompt.style.lineHeight=this.stripH+"px",this.loadPrompt.style.lineHeight=this.stripH+"px",this.successPrompt.style.lineHeight=this.stripH+"px",this.failPrompt.style.lineHeight=this.stripH+"px",c=function(b){void 0===b&&(b="");var c=a.splice.getAttribute("class");c=c?c.replace(/\s*bc--[a-z]+/g,"")+" "+b:b,a.splice.setAttribute("class",c)},c("bc--ready"),this.loadImgs(this.imgs,function(d){var e,f,g,h,i,j,k;c("bc--start"),a.imgObjs=d,e=null,f=null,g=a.splice.offsetWidth-a.slideBtn.offsetWidth,h=function(){a.checking=!1,a.strip.style.width=a.slideBtn.offsetWidth+"px",a.piece.style.transform="translateX(0)",a.piece.style.msTransform="translateX(0)",a.randomImgInfo.index=a.getRandomInt(0,a.imgObjs.length-1,a.randomImgInfo.index),a.randomImgInfo.obj=a.imgObjs[a.randomImgInfo.index],a.randomRipInfo={x:a.getRandomInt(a.range.left,a.rip.width-a.size-a.range.right),y:a.getRandomInt(a.range.top,a.rip.height-a.size-a.range.bottom)},e=a.randomRipInfo.x/a.scale-a.piece.offsetLeft-a.dis.left,f=a.randomRipInfo.x/a.scale-a.piece.offsetLeft+a.dis.right,a.piece.style.top=a.randomRipInfo.y/a.scale+"px",a.setRipArea({finish:function(b,c,d,e){a.randomImgInfo.x=b,a.randomImgInfo.y=c,a.randomImgInfo.width=d,a.randomImgInfo.height=e}}),a.setPieceArea()},i=function(){return a.checking?!1:void 0},j=function(b){a.strip.style.width=b+a.slideBtn.offsetWidth+"px",a.piece.style.msTransform="translateX("+b+"px)",a.piece.style.transform="translateX("+b+"px)"},k=function(b){var d,g;c("bc--check"),a.checking=!0,d=function(){c("bc--success"),a.removeClass(a.screen,"bc--active"),a.success&&a.success()},g=function(){c("bc--fail");var b=setTimeout(function(){clearTimeout(b),c(),h()},800);a.fail&&a.fail()},b>=e&&f>=b?a.condition?a.condition(d,g):d():g()},h(),a.startPrompt.addEventListener("click",function(){a.addClass(a.screen,"bc--active"),c(),h()}),a.closeBtn.addEventListener("click",function(){a.removeClass(a.screen,"bc--active"),c("bc--start")}),a.updateBtn.addEventListener("click",function(){h()}),b({object:a.slideBtn,maxDistance:g,createBefore:i,progress:j,finish:k}),b({object:a.piece,maxDistance:g,createBefore:i,progress:j,finish:k})})},b.setToInt=function(a){return Math.floor(a+.5)},b.getRandomInt=function(a,b,c){for(var d=parseInt(Math.random()*(b+1-a)+a);d===b+1||d===c;)d=parseInt(Math.random()*(b+1-a)+a);return d},b.loadImgs=function(a,b){var f,c=[],d=0,e=function(e){var f=new Image;f.src=a[e],f.onload=function(){d++,c.push(f),d===a.length&&b&&b(c)}};for(f=0;f<a.length;f++)e(f)},b.removeClass=function(a,b){var c=a.getAttribute("class");null!==c&&a.setAttribute("class",c.replace(new RegExp("s*"+b,"g"),""))},b.addClass=function(a,b){var c=a.getAttribute("class");c?c+=" "+b:c=b,a.setAttribute("class",c)},b.createSlideXTouchEvent=function(a){var b=a.object,c=a.maxDistance,d=a.createBefore,e=a.progress,f=a.finish,g=null,h=null,i=function(a){d&&d()===!1||(g=a.targetTouches[0].clientX,document.addEventListener("touchmove",j),document.addEventListener("touchend",k))},j=function(a){h=a.targetTouches[0].clientX-g,0>=h?h=0:h>=c&&(h=c),e&&e(h)},k=function n(){f&&f(h),document.removeEventListener("touchmove",j,{passive:!0}),document.removeEventListener("touchend",n)};b.addEventListener("touchstart",i,{passive:!0})},b.createSlideXMouseEvent=function(a){var b=a.object,c=a.maxDistance,d=a.createBefore,e=a.progress,f=a.finish,g=null,h=null,i=function(a){d&&d()===!1||(g=a.clientX,a.preventDefault(),document.addEventListener("mousemove",j),document.addEventListener("mouseup",k))},j=function(a){h=a.clientX-g,0>=h?h=0:h>=c&&(h=c),e&&e(h),a.preventDefault()},k=function n(){f&&f(h),document.removeEventListener("mousemove",j),document.removeEventListener("mouseup",n)};b.addEventListener("mousedown",i)},b.createDiv=function(a,b){var c=document.createElement("div");return this.addClass(c,b),a.appendChild(c),c},b.createCanvas=function(a,b,c){var d=document.createElement("canvas");return this.addClass(d,b),a.appendChild(d),d.width=d.offsetWidth*c,d.height=d.offsetHeight*c,d},b.createPiecePath=function(a,b,c,d){var e=d/164,f=Math.PI/180,g=this.setToInt;return a.beginPath(),a.lineTo(g(b),g(44*e+c)),a.arc(g(60*e+b),g(25*e+c),25*e,-230*f,50*f),a.lineTo(g(120*e+b),g(44*e+c)),a.arc(g(139*e+b),g(104*e+c),g(25*e),-140*f,140*f),a.lineTo(g(120*e+b),g(164*e+c)),a.lineTo(g(b),g(164*e+c)),a.lineTo(g(b),g(120*e+c)),a.arc(g(19*e+b),g(104*e+c),g(25*e),140*f,-140*f,!0),a.closePath(),a},b.setRipArea=function(a){var b=a.finish,c=this.ripArea,d=this.randomImgInfo.x,e=this.randomImgInfo.y,f=this.randomImgInfo.obj.width,g=this.randomImgInfo.obj.height;f/g>this.rip.width/this.rip.height?(f=this.rip.height*f/g,g=this.rip.height,d=(this.rip.width-f)/2):(g=this.rip.width*g/f,f=this.rip.width,e=(this.rip.height-g)/2),c.clearRect(0,0,Math.ceil(this.rip.width),Math.ceil(this.rip.height)),c.beginPath(),c.save(),c.drawImage(this.randomImgInfo.obj,this.setToInt(d),this.setToInt(e),this.setToInt(f),this.setToInt(g)),c=this.createPiecePath(c,this.randomRipInfo.x,this.randomRipInfo.y,this.size),c.shadowColor="#000",c.shadowBlur=10,c.fillStyle="#fff",c.globalAlpha=.4,c.fill(),c.restore(),b&&b(d,e,f,g)},b.setPieceArea=function(){var a=this.pieceArea;a.clearRect(0,0,Math.ceil(this.size),Math.ceil(this.piece.height)),a.beginPath(),a.save(),a=this.createPiecePath(a,0,0,this.size),a.clip(),a.drawImage(this.randomImgInfo.obj,-this.setToInt(this.randomRipInfo.x+(this.randomImgInfo.width-this.rip.width)/2),-this.setToInt(this.randomRipInfo.y+(this.randomImgInfo.height-this.rip.height)/2),this.setToInt(this.randomImgInfo.width),this.setToInt(this.randomImgInfo.height)),a.globalAlpha=.5,a.lineWidth=6,a.strokeStyle="#fff",a.stroke(),a.lineWidth=2,a.strokeStyle="#000",a.stroke(),a.restore()},a}();